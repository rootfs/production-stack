---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: backends.production-stack.vllm.ai
spec:
  group: production-stack.vllm.ai
  names:
    kind: Backend
    listKind: BackendList
    plural: backends
    singular: backend
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Backend type
      jsonPath: .spec.type
      name: Type
      type: string
    - description: Backend URL endpoint
      jsonPath: .spec.endpoint.url
      name: Endpoint
      type: string
    - description: Backend Kubernetes service
      jsonPath: .spec.endpoint.service.objectReference.name
      name: Service
      type: string
    - description: Backend availability
      jsonPath: .status.isAvailable
      name: Available
      type: boolean
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Backend is the Schema for the backends API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: BackendSpec defines the desired state of Backend
            properties:
              authSecret:
                description: AuthSecret is a reference to a secret containing authentication
                  information (optional)
                properties:
                  name:
                    description: name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              endpoint:
                description: Endpoint defines how to connect to the backend service
                maxProperties: 1
                properties:
                  fqdn:
                    description: FQDN is a fully qualified domain name endpoint
                    properties:
                      hostname:
                        description: Hostname is the FQDN hostname
                        pattern: ^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$
                        type: string
                      port:
                        description: Port is the port number
                        format: int32
                        maximum: 65535
                        minimum: 1
                        type: integer
                    required:
                    - hostname
                    - port
                    type: object
                  ip:
                    description: IP is an IP address endpoint
                    properties:
                      address:
                        description: Address is the IP address
                        pattern: ^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$
                        type: string
                      port:
                        description: Port is the port number
                        format: int32
                        maximum: 65535
                        minimum: 1
                        type: integer
                    required:
                    - address
                    - port
                    type: object
                  service:
                    description: Service is a reference to a Kubernetes service
                    properties:
                      objectReference:
                        description: Reference to a Kubernetes service
                        properties:
                          apiVersion:
                            description: API version of the referent.
                            type: string
                          fieldPath:
                            description: |-
                              If referring to a piece of an object instead of an entire object, this string
                              should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                              For example, if the object reference is to a container within a pod, this would take on a value like:
                              "spec.containers{name}" (where "name" refers to the name of the container that triggered
                              the event) or if no container name is specified "spec.containers[2]" (container with
                              index 2 in this pod). This syntax is chosen only to have some well-defined way of
                              referencing a part of an object.
                            type: string
                          kind:
                            description: |-
                              Kind of the referent.
                              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                            type: string
                          name:
                            description: |-
                              Name of the referent.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                          namespace:
                            description: |-
                              Namespace of the referent.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                            type: string
                          resourceVersion:
                            description: |-
                              Specific resourceVersion to which this reference is made, if any.
                              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                            type: string
                          uid:
                            description: |-
                              UID of the referent.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                            type: string
                        type: object
                        x-kubernetes-map-type: atomic
                      port:
                        description: Port is the port number of the service
                        format: int32
                        maximum: 65535
                        minimum: 1
                        type: integer
                      targetPort:
                        description: TargetPort is the target port of the service
                        format: int32
                        maximum: 65535
                        minimum: 1
                        type: integer
                    required:
                    - objectReference
                    - port
                    type: object
                  unix:
                    description: Unix is a unix domain socket endpoint
                    properties:
                      path:
                        description: Path is the path to the unix domain socket
                        pattern: ^/[a-zA-Z0-9_\-\.\/]+$
                        type: string
                    required:
                    - path
                    type: object
                  url:
                    description: URL is a direct URL to the backend service
                    pattern: ^(http|https)://[^\s/$.?#].[^\s]*$
                    type: string
                type: object
              healthCheck:
                description: HealthCheck defines the health check configuration for
                  the backend
                properties:
                  failureThreshold:
                    default: 3
                    description: Minimum consecutive failures for the probe to be
                      considered failed
                    format: int32
                    minimum: 1
                    type: integer
                  periodSeconds:
                    default: 10
                    description: Number of seconds between probe attempts
                    format: int32
                    minimum: 1
                    type: integer
                  successThreshold:
                    default: 1
                    description: Minimum consecutive successes for the probe to be
                      considered successful
                    format: int32
                    minimum: 1
                    type: integer
                  timeoutSeconds:
                    default: 5
                    description: Number of seconds after which the probe times out
                    format: int32
                    minimum: 1
                    type: integer
                type: object
              maxConcurrentRequests:
                default: 100
                description: MaxConcurrentRequests is the maximum number of concurrent
                  requests this backend can handle
                format: int32
                minimum: 1
                type: integer
              models:
                description: Models is a comma-separated list of model names supported
                  by this backend
                type: string
              secretRef:
                description: SecretRef is a reference to a secret containing API keys
                  for this backend
                properties:
                  key:
                    description: Key is the key in the secret to use
                    type: string
                  name:
                    description: Name is the name of the secret
                    type: string
                  namespace:
                    description: Namespace is the namespace of the secret
                    type: string
                required:
                - key
                - name
                type: object
              serviceRef:
                description: |-
                  ServiceRef is a reference to the backend service in Kubernetes (optional)
                  Deprecated: Use Endpoint.Service instead
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              timeout:
                default: 300
                description: Timeout is the request timeout in seconds
                format: int32
                minimum: 1
                type: integer
              type:
                default: vllm
                description: Type specifies the type of backend
                enum:
                - vllm
                - openai
                - ollama
                type: string
            required:
            - endpoint
            - models
            - type
            type: object
          status:
            description: BackendStatus defines the observed state of Backend
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the Backend's state
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              currentLoad:
                description: CurrentLoad represents the current load on the backend
                format: int32
                type: integer
              isAvailable:
                description: IsAvailable indicates whether the backend is available
                type: boolean
              lastProbeTime:
                description: LastProbeTime is the last time the backend was probed
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
